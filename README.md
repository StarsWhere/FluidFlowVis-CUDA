
# 流场数据交互式分析平台-CUDA v1.3

这是一个使用 Python、PyQt6 和 Matplotlib 构建的桌面应用程序，旨在为流场模拟（CFD）数据提供一个高效、交互式的可视化分析环境。用户可以加载以CSV格式存储的逐帧数据，通过直观的图形界面进行探索、分析和导出。

 <!-- 建议替换为您应用的截图 -->

## 主要功能

- **动态数据加载**: 自动扫描指定目录下的 `.csv` 文件序列作为动画帧。
- **多变量可视化**:
    - **自定义坐标轴**: 自由选择数据文件中的任意数值列作为 `X` 轴和 `Y` 轴。
    - **背景热力图**: 将任意变量或自定义公式的结果渲染为背景颜色图。
    - **前景等高线**: 在热力图之上叠加另一变量或公式的等高线。
- **强大的公式引擎**:
    - 使用标准数学表达式（如 `sqrt(u**2 + v**2)`）创建派生变量用于可视化，无需预处理数据。
    - 内置详细的**公式帮助指南**，列出所有可用函数、常量和数据变量。
- **交互式分析工具**:
    - **播放控制**: 控制动画的播放、暂停、逐帧步进，并调整播放速度。
    - **数据探针**: 鼠标悬停在图上即可实时显示该点坐标及所有变量的数值。
    - **视图操控**: 通过鼠标滚轮缩放、拖拽平移视图，并可一键重置。
    - **颜色范围拾取**: 直接从图中点击拾取数值，精确控制热力图的颜色映射范围。
- **高性能设计**:
    - **智能播放**: 渲染延迟时自动跳帧，保证流畅的动画预览。
    - **内存缓存**: 缓存最近访问的数据帧，加快重复访问速度。
    - **并行处理**: 在导出视频时，利用多CPU核心并行渲染帧，大幅缩短导出时间。
    - **GPU 加速 (可选)**: 若系统已安装 NVIDIA 显卡和 CuPy，可一键启用GPU来加速复杂的公式计算和视频渲染。
- **丰富的导出选项**:
    - **高分辨率图片**: 将当前视图保存为 PNG 图片，可自定义DPI。
    - **高清视频**: 将指定帧范围导出为 MP4 视频或 GIF 动画。
- **配置管理**:
    - **会话持久化**: 自动保存和恢复窗口大小、位置以及部分常用设置。
    - **配置导入/导出**: 将完整的可视化方案（包括坐标轴、公式、颜色等）保存为 JSON 文件，方便共享和复现。

## 安装指南

### 1. 克隆或下载项目

首先，获取项目代码。

```bash
git clone https://github.com/your-username/your-repository-name.git
cd your-repository-name
```

### 2. 创建虚拟环境 (推荐)

为了保持项目依赖的隔离，建议使用虚拟环境。

```bash
# Windows
python -m venv venv
.\venv\Scripts\activate

# macOS / Linux
python3 -m venv venv
source venv/bin/activate
```

### 3. 安装依赖

项目的所有核心依赖都记录在 `requirements.txt` 文件中。

```bash
pip install -r requirements.txt
```

这将安装 PyQt6, NumPy, Pandas, Matplotlib, SciPy, moviepy, imageio 等所有必需的库。

### 4. (可选) 安装GPU加速支持

如果您的计算机配备了 **NVIDIA 显卡** 并且已经安装了 **CUDA Toolkit**，您可以安装 CuPy 来启用GPU加速功能。这将极大地提升公式计算和视频导出的性能。

**请不要**直接 `pip install cupy`。您需要根据您的CUDA版本安装对应的CuPy包。

1.  **检查您的CUDA版本**:
    在终端中运行 `nvcc --version`。

2.  **访问 CuPy 官网**:
    前往 [CuPy 官方安装指南](https://cupy.dev/)，找到与您的CUDA版本、Python版本和操作系统匹配的安装命令。

3.  **运行安装命令**:
    例如，如果您的CUDA版本是 11.8，安装命令通常是：
    ```bash
    pip install cupy-cuda11x
    ```
    如果您的CUDA版本是 12.x，则可能是：
    ```bash
    pip install cupy-cuda12x
    ```

安装成功后，程序启动时会自动检测到 CuPy 并启用 "GPU加速" 选项。

## 使用方法

1.  **准备数据**:
    - 将您的流场数据整理成一系列的 `.csv` 文件，每个文件代表一个时间步（一帧）。
    - 确保所有CSV文件的列名（表头）一致。
    - 将所有CSV文件放入一个文件夹，例如项目根目录下的 `data` 文件夹。

2.  **运行程序**:
    在项目根目录下，运行主程序。
    ```bash
    python main.py
    ```

3.  **基本操作流程**:
    - 程序启动后，会自动尝试加载 `data` 目录下的数据。如果您的数据在别处，请通过 **路径设置 -> 数据目录 -> 更改** 来选择您的数据文件夹。
    - 在 **可视化** 选项卡中，选择您想作为 `X` 轴和 `Y` 轴的变量。
    - 选择您想可视化的变量（例如，用 `p` (压力) 做热力图）。
    - 点击 **应用可视化设置** 按钮刷新视图。
    - 使用底部的 **播放控制** 面板来播放动画或查看特定帧。
    - 在 **导出与性能** 选项卡中，您可以找到导出图片、视频以及配置性能的选项。

## 文件结构

```
.
├── main.py                 # 主程序入口
├── requirements.txt        # 项目依赖列表
├── README.md               # 本文档
├── data/                   # (示例) 存放CSV数据文件的默认目录
├── output/                 # (自动创建) 存放导出图片和视频的默认目录
├── logs/                   # (自动创建) 存放运行日志的目录
└── src/                    # 源代码目录
    ├── __init__.py
    ├── main_window.py        # 主窗口UI与核心逻辑
    ├── core/                 # 核心功能模块
    │   ├── data_manager.py
    │   └── formula_validator.py
    ├── utils/                # 辅助工具模块
    │   ├── gpu_utils.py
    │   ├── help_dialog.py
    │   └── logger.py
    └── visualization/        # 可视化相关模块
        ├── plot_widget.py
        └── video_exporter.py
```

## 技术栈

- **GUI框架**: PyQt6
- **数据处理**: NumPy, Pandas
- **插值计算**: SciPy
- **绘图引擎**: Matplotlib
- **视频导出**: MoviePy, ImageIO
- **GPU加速**: CuPy (可选)

---